"use strict";function bytesToUuid(t,e){var n=e||0,o=byteToHex;return o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+"-"+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]+o[t[n++]]}function v4(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var r=(t=t||{}).random||(t.rng||rngBrowser)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e)for(var i=0;i<16;++i)e[o+i]=r[i];return e||bytesToUuid_1(r)}function buildRelationshipData(t,e){var n=[];return null===e||0===e.length?[]:"string"==typeof e?[{type:t,id:e}]:(Array.isArray(e)&&(n=e.map(function(e){return{type:t,id:e}})),n)}function cartIdentifier(){var t=new StorageFactory,e=v4_1();return null!==t.get("mcart")?t.get("mcart"):(t.set("mcart",e),e)}function parseJSON(t){return 204===t.status?new Promise(function(e){e({status:t.status,ok:t.ok,json:"{}"})}):new Promise(function(e){return t.json().then(function(n){return e({status:t.status,ok:t.ok,json:n})})})}function formatFilterString(t,e){return Object.keys(e).map(function(n){var o=e[n];return t+"("+n+","+o+")"}).join(":")}function formatQueryString(t,e){if("limit"===t||"offset"===t)return"page"+e;if("filter"===t){return t+"="+Object.keys(e).map(function(t){return formatFilterString(t,e[t])}).join(":")}return t+"="+e}function buildQueryParams(t){var e=t.includes,n=t.sort,o=t.limit,r=t.offset,i=t.filter,s={};return e&&(s.include=e),n&&(s.sort="("+n+")"),o&&(s.limit="[limit]="+o),r&&(s.offset="[offset]="+r),i&&(s.filter=i),Object.keys(s).map(function(t){return formatQueryString(t,s[t])}).join("&")}function buildURL(t,e){if(e.includes||e.sort||e.limit||e.offset||e.filter){return t+"?"+buildQueryParams(e)}return t}function buildRequestBody(t){var e;return t&&(e='{\n      "data": '+JSON.stringify(t)+"\n    }"),e}function buildCartItemData(t,e,n){void 0===e&&(e=null),void 0===n&&(n="cart_item");var o={type:n};return"cart_item"===n&&Object.assign(o,{id:t,quantity:parseInt(e,10)}),"promotion_item"===n&&Object.assign(o,{code:t}),o}Object.defineProperty(exports,"__esModule",{value:!0}),require("fetch-everywhere"),require("es6-promise");var inflected=require("inflected"),version="0.0.0-semantic-release",Config=function(t){var e=t.application,n=t.client_id,o=t.client_secret,r=t.currency,i=t.host;this.application=e,this.client_id=n,this.client_secret=o,this.host=i||"api.moltin.com",this.protocol="https",this.version="v2",this.currency=r,this.auth={expires:3600,uri:"oauth/access_token"},this.sdk={version:version,language:"JS"}},StorageFactory=function(){if("undefined"==typeof localStorage||null===localStorage){var t=require("node-localstorage").LocalStorage;this.localStorage=new t("./localStorage")}else this.localStorage=window.localStorage};StorageFactory.prototype.set=function(t,e){return this.localStorage.setItem(t,e)},StorageFactory.prototype.get=function(t){return this.localStorage.getItem(t)},StorageFactory.prototype.delete=function(t){return this.localStorage.removeItem(t)};var rng,commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},crypto=commonjsGlobal.crypto||commonjsGlobal.msCrypto;if(crypto&&crypto.getRandomValues){var rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(rnds8),rnds8}}if(!rng){var rnds=new Array(16);rng=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),rnds[e]=t>>>((3&e)<<3)&255;return rnds}}for(var rngBrowser=rng,byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);var bytesToUuid_1=bytesToUuid,v4_1=v4,RequestFactory=function(t){this.config=t,this.storage=new StorageFactory};RequestFactory.prototype.authenticate=function(){var t=this.config,e=this.storage;if(!t.client_id)throw new Error("You must have a client_id set");if(!t.host)throw new Error("You have not specified an API host");var n={grant_type:t.client_secret?"client_credentials":"implicit",client_id:t.client_id};t.client_secret&&(n.client_secret=t.client_secret);var o=new Promise(function(e,o){fetch(t.protocol+"://"+t.host+"/"+t.auth.uri,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object.keys(n).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(n[t])}).join("&")}).then(parseJSON).then(function(t){t.ok&&e(t.json),o(t.json)}).catch(function(t){return o(t)})});return o.then(function(t){e.set("mtoken",t.access_token),e.set("mexpires",t.expires)}),o},RequestFactory.prototype.send=function(t,e,n,o){var r=this;void 0===n&&(n=void 0),void 0===o&&(o=void 0);var i=this.config,s=this.storage;return new Promise(function(u,a){var c=function(){var r={Authorization:"Bearer: "+s.get("mtoken"),"Content-Type":"application/json","X-MOLTIN-SDK-LANGUAGE":i.sdk.language,"X-MOLTIN-SDK-VERSION":i.sdk.version};i.application&&(r["X-MOLTIN-APPLICATION"]=i.application),i.currency&&(r["X-MOLTIN-CURRENCY"]=i.currency),o&&(r["X-MOLTIN-CUSTOMER-TOKEN"]=o),fetch(i.protocol+"://"+i.host+"/"+i.version+"/"+t,{method:e.toUpperCase(),headers:r,body:buildRequestBody(n)}).then(parseJSON).then(function(t){t.ok&&u(t.json),a(t.json)}).catch(function(t){return a(t)})};return!s.get("mtoken")||Date.now().toString()>=s.get("mexpires")?r.authenticate().then(c).catch(function(t){return a(t)}):c()})};var BaseExtend=function(t){this.request=new RequestFactory(t),this.config=t};BaseExtend.prototype.All=function(t){void 0===t&&(t=null);var e=this.includes,n=this.sort,o=this.limit,r=this.offset,i=this.filter;return this.call=this.request.send(buildURL(this.endpoint,{includes:e,sort:n,limit:o,offset:r,filter:i}),"GET",void 0,t),this.call},BaseExtend.prototype.Get=function(t){return this.call=this.request.send(buildURL(this.endpoint+"/"+t,{includes:this.includes}),"GET"),this.call},BaseExtend.prototype.Limit=function(t){return this.limit=t,this},BaseExtend.prototype.Offset=function(t){return this.offset=t,this},BaseExtend.prototype.Sort=function(t){return this.sort=t,this};var CatalogueExtend=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Create=function(t){return this.request.send(""+this.endpoint,"POST",t)},e.prototype.Delete=function(t){return this.request.send(this.endpoint+"/"+t,"DELETE")},e.prototype.Update=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",e)},e.prototype.With=function(t){return t&&(this.includes=t.toString().toLowerCase()),this},e}(BaseExtend),ProductsEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="products"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Filter=function(t){return this.filter=t,this},e.prototype.CreateRelationships=function(t,e,n){var o=buildRelationshipData(e,n);return this.request.send(this.endpoint+"/"+t+"/relationships/"+inflected.pluralize(e),"POST",o)},e.prototype.DeleteRelationships=function(t,e,n){var o=buildRelationshipData(e,n);return this.request.send(this.endpoint+"/"+t+"/relationships/"+inflected.pluralize(e),"DELETE",o)},e.prototype.UpdateRelationships=function(t,e,n){void 0===n&&(n=null);var o=buildRelationshipData(e,n);return this.request.send(this.endpoint+"/"+t+"/relationships/"+inflected.pluralize(e),"PUT",o)},e}(CatalogueExtend),CurrenciesEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="currencies",this.storage=new StorageFactory}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Create=function(t){return this.request.send(""+this.endpoint,"POST",t)},e.prototype.Delete=function(t){return this.request.send(this.endpoint+"/"+t,"DELETE")},e.prototype.Update=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",e)},e.prototype.Set=function(t){var e=this.config,n=this.storage;n.set("mcurrency",t),e.currency=t;return new Promise(function(t,e){var o=n.get("mcurrency");try{t(o)}catch(t){e(new Error(t))}})},e.prototype.Active=function(){var t=this.storage;return new Promise(function(e,n){var o=t.get("mcurrency");try{e(o)}catch(t){n(new Error(t))}})},e}(BaseExtend),BrandsEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="brands"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(CatalogueExtend),CartEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="carts",this.cartId=cartIdentifier()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Get=function(t){return void 0===t&&(t=this.cartId),this.request.send(this.endpoint+"/"+t,"GET")},e.prototype.Items=function(t){return void 0===t&&(t=this.cartId),this.request.send(this.endpoint+"/"+t+"/items","GET")},e.prototype.AddProduct=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=this.cartId);var o=buildCartItemData(t,e);return this.request.send(this.endpoint+"/"+n+"/items","POST",o)},e.prototype.AddCustomItem=function(t,e){void 0===e&&(e=this.cartId);var n=Object.assign(t,{type:"custom_item"});return this.request.send(this.endpoint+"/"+e+"/items","POST",n)},e.prototype.AddPromotion=function(t,e){void 0===e&&(e=this.cartId);var n=buildCartItemData(t,null,"promotion_item");return this.request.send(this.endpoint+"/"+e+"/items","POST",n)},e.prototype.RemoveItem=function(t,e){return void 0===e&&(e=this.cartId),this.request.send(this.endpoint+"/"+e+"/items/"+t,"DELETE")},e.prototype.UpdateItemQuantity=function(t,e,n){void 0===n&&(n=this.cartId);var o=buildCartItemData(t,e);return this.request.send(this.endpoint+"/"+n+"/items/"+t,"PUT",o)},e.prototype.Checkout=function(t,e){return void 0===e&&(e=this.cartId),this.request.send(this.endpoint+"/"+e+"/checkout","POST",t)},e.prototype.Delete=function(t){return void 0===t&&(t=this.cartId),this.request.send(this.endpoint+"/"+t,"DELETE")},e}(BaseExtend),CategoriesEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="categories"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Tree=function(){return this.request.send(this.endpoint+"/tree","GET")},e}(CatalogueExtend),CollectionsEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="collections"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(CatalogueExtend),OrdersEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="orders"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Items=function(t){return this.request.send(this.endpoint+"/"+t+"/items","GET")},e.prototype.Payment=function(t,e){return this.request.send(this.endpoint+"/"+t+"/payments","POST",e)},e.prototype.Transactions=function(t){return this.request.send(this.endpoint+"/"+t+"/transactions","GET")},e}(BaseExtend),GatewaysEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="gateways"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Update=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",e)},e.prototype.Enabled=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",{type:"gateway",enabled:e})},e}(BaseExtend),CustomersEndpoint=function(t){function e(e){t.call(this,e),this.endpoint="customers"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Create=function(t){return this.request.send(""+this.endpoint,"POST",t)},e.prototype.Delete=function(t){return this.request.send(this.endpoint+"/"+t,"DELETE")},e.prototype.Token=function(t,e){var n={type:"token",email:t,password:e};return this.request.send(this.endpoint+"/tokens","POST",n)},e.prototype.Update=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",e)},e}(BaseExtend),Moltin=function(t){this.config=t,this.request=new RequestFactory(t),this.storage=new StorageFactory,this.Products=new ProductsEndpoint(t),this.Currencies=new CurrenciesEndpoint(t),this.Brands=new BrandsEndpoint(t),this.Cart=new CartEndpoint(t),this.Categories=new CategoriesEndpoint(t),this.Collections=new CollectionsEndpoint(t),this.Orders=new OrdersEndpoint(t),this.Gateways=new GatewaysEndpoint(t),this.Customers=new CustomersEndpoint(t)};Moltin.prototype.Authenticate=function(){return this.request.authenticate()};var gateway=function(t){return new Moltin(new Config(t))};exports.default=Moltin,exports.gateway=gateway;
//# sourceMappingURL=moltin.cjs.js.map
