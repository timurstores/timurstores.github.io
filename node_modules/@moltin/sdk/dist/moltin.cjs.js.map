{"version":3,"file":"moltin.cjs.js","sources":["../node_modules/uuid/lib/bytesToUuid.js","../node_modules/uuid/v4.js","../src/utils/helpers.js","../src/config.js","../src/factories/storage.js","../node_modules/uuid/lib/rng-browser.js","../src/factories/request.js","../src/extends/base.js","../src/extends/catalogue.js","../src/endpoints/products.js","../src/endpoints/currencies.js","../src/endpoints/brands.js","../src/endpoints/cart.js","../src/endpoints/categories.js","../src/endpoints/collections.js","../src/endpoints/orders.js","../src/endpoints/gateways.js","../src/endpoints/customers.js","../src/moltin.js"],"sourcesContent":["/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","import uuidv4 from 'uuid/v4';\nimport StorageFactory from '../factories/storage';\n\nexport function buildRelationshipData(type, ids) {\n  let data = [];\n\n  if (ids === null || ids.length === 0) {\n    return [];\n  }\n\n  if (typeof ids === 'string') {\n    return [{\n      type,\n      id: ids,\n    }];\n  }\n\n  if (Array.isArray(ids)) {\n    data = ids.map(id => ({\n      type,\n      id,\n    }));\n  }\n\n  return data;\n}\n\nexport function cartIdentifier() {\n  const storage = new StorageFactory();\n  const cartId = uuidv4();\n\n  if (storage.get('mcart') !== null) {\n    return storage.get('mcart');\n  }\n\n  storage.set('mcart', cartId);\n\n  return cartId;\n}\n\nexport function parseJSON(response) {\n  if (response.status === 204) {\n    return new Promise((resolve) => {\n      resolve({\n        status: response.status,\n        ok: response.ok,\n        json: '{}',\n      });\n    });\n  }\n\n  return new Promise(resolve => response.json()\n  .then(json => resolve({\n    status: response.status,\n    ok: response.ok,\n    json,\n  })));\n}\n\nfunction formatFilterString(type, filter) {\n  const filterStringArray = Object.keys(filter).map((key) => {\n    const value = filter[key];\n\n    return `${type}(${key},${value})`;\n  });\n\n  return filterStringArray.join(':');\n}\n\nfunction formatQueryString(key, value) {\n  if (key === 'limit' || key === 'offset') {\n    return `page${(value)}`;\n  }\n\n  if (key === 'filter') {\n    const filterValues = Object.keys(value).map(\n      filter => formatFilterString(filter, value[filter]));\n\n    return `${key}=${filterValues.join(':')}`;\n  }\n\n  return `${key}=${value}`;\n}\n\nfunction buildQueryParams({ includes, sort, limit, offset, filter }) {\n  const query = {};\n\n  if (includes) {\n    query.include = includes;\n  }\n\n  if (sort) {\n    query.sort = `(${sort})`;\n  }\n\n  if (limit) {\n    query.limit = `[limit]=${limit}`;\n  }\n\n  if (offset) {\n    query.offset = `[offset]=${offset}`;\n  }\n\n  if (filter) {\n    query.filter = filter;\n  }\n\n  return Object.keys(query).map(k => formatQueryString(k, query[k])).join('&');\n}\n\nexport function buildURL(endpoint, params) {\n  if (params.includes || params.sort || params.limit || params.offset || params.filter) {\n    const paramsString = buildQueryParams(params);\n\n    return `${endpoint}?${paramsString}`;\n  }\n\n  return endpoint;\n}\n\nexport function buildRequestBody(body) {\n  let parsedBody;\n\n  if (body) {\n    parsedBody = `{\n      \"data\": ${JSON.stringify(body)}\n    }`;\n  }\n\n  return parsedBody;\n}\n\nexport function buildCartItemData(id, quantity = null, type = 'cart_item') {\n  const payload = {\n    type,\n  };\n\n  if (type === 'cart_item') {\n    Object.assign(payload, {\n      id,\n      quantity: parseInt(quantity, 10),\n    });\n  }\n\n  if (type === 'promotion_item') {\n    Object.assign(payload, {\n      code: id,\n    });\n  }\n\n  return payload;\n}\n","import { version } from '../package.json';\n\nclass Config {\n  constructor(options) {\n    const { application, client_id, client_secret, currency, host } = options;\n\n    this.application = application;\n    this.client_id = client_id;\n    this.client_secret = client_secret;\n    this.host = host || 'api.moltin.com';\n    this.protocol = 'https';\n    this.version = 'v2';\n    this.currency = currency;\n    this.auth = {\n      expires: 3600,\n      uri: 'oauth/access_token',\n    };\n    this.sdk = {\n      version,\n      language: 'JS',\n    };\n  }\n}\n\nexport default Config;\n","/* eslint no-undef: \"off\",\n          global-require: \"off\"\n*/\n\nclass StorageFactory {\n  constructor() {\n    if (typeof localStorage === 'undefined' || localStorage === null) {\n      const LocalStorage = require('node-localstorage').LocalStorage;\n\n      this.localStorage = new LocalStorage('./localStorage');\n    } else {\n      this.localStorage = window.localStorage;\n    }\n  }\n\n  set(key, value) {\n    return this.localStorage.setItem(key, value);\n  }\n\n  get(key) {\n    return this.localStorage.getItem(key);\n  }\n\n  delete(key) {\n    return this.localStorage.removeItem(key);\n  }\n}\n\nexport default StorageFactory;\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n","import StorageFactory from './storage';\nimport { buildRequestBody, parseJSON } from '../utils/helpers';\n\nclass RequestFactory {\n  constructor(config) {\n    this.config = config;\n\n    this.storage = new StorageFactory();\n  }\n\n  authenticate() {\n    const { config, storage } = this;\n\n    if (!config.client_id) {\n      throw new Error('You must have a client_id set');\n    }\n\n    if (!config.host) {\n      throw new Error('You have not specified an API host');\n    }\n\n    const body = {\n      grant_type: config.client_secret ? 'client_credentials' : 'implicit',\n      client_id: config.client_id,\n    };\n\n    if (config.client_secret) {\n      body.client_secret = config.client_secret;\n    }\n\n    const promise = new Promise((resolve, reject) => {\n      fetch(`${config.protocol}://${config.host}/${config.auth.uri}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: Object.keys(body).map(k => `${encodeURIComponent(k)}=${encodeURIComponent(body[k])}`).join('&'),\n      })\n      .then(parseJSON)\n      .then((response) => {\n        if (response.ok) {\n          resolve(response.json);\n        }\n\n        reject(response.json);\n      })\n      .catch(error => reject(error));\n    });\n\n    promise.then((response) => {\n      storage.set('mtoken', response.access_token);\n      storage.set('mexpires', response.expires);\n    });\n\n    return promise;\n  }\n\n  send(uri, method, body = undefined, token = undefined) {\n    const { config, storage } = this;\n\n    const promise = new Promise((resolve, reject) => {\n      const req = () => {\n        const headers = {\n          Authorization: `Bearer: ${storage.get('mtoken')}`,\n          'Content-Type': 'application/json',\n          'X-MOLTIN-SDK-LANGUAGE': config.sdk.language,\n          'X-MOLTIN-SDK-VERSION': config.sdk.version,\n        };\n\n        if (config.application) {\n          headers['X-MOLTIN-APPLICATION'] = config.application;\n        }\n\n        if (config.currency) {\n          headers['X-MOLTIN-CURRENCY'] = config.currency;\n        }\n\n        if (token) {\n          headers['X-MOLTIN-CUSTOMER-TOKEN'] = token;\n        }\n\n        /* eslint no-undef: \"off\" */\n        fetch(`${config.protocol}://${config.host}/${config.version}/${uri}`, {\n          method: method.toUpperCase(),\n          headers,\n          body: buildRequestBody(body),\n        })\n        .then(parseJSON)\n        .then((response) => {\n          if (response.ok) {\n            resolve(response.json);\n          }\n\n          reject(response.json);\n        })\n        .catch(error => reject(error));\n      };\n\n      if (!storage.get('mtoken') || Date.now().toString() >= storage.get('mexpires')) {\n        return this.authenticate()\n        .then(req)\n        .catch(error => reject(error));\n      }\n\n      return req();\n    });\n\n    return promise;\n  }\n}\n\nexport default RequestFactory;\n","import RequestFactory from '../factories/request';\nimport { buildURL } from '../utils/helpers';\n\nclass BaseExtend {\n  constructor(config) {\n    this.request = new RequestFactory(config);\n\n    this.config = config;\n  }\n\n  All(token = null) {\n    const { includes, sort, limit, offset, filter } = this;\n\n    this.call = this.request.send(buildURL(this.endpoint, {\n      includes,\n      sort,\n      limit,\n      offset,\n      filter,\n    }), 'GET', undefined, token);\n\n    return this.call;\n  }\n\n  Get(id) {\n    this.call = this.request.send(buildURL(`${this.endpoint}/${id}`, {\n      includes: this.includes,\n    }), 'GET');\n\n    return this.call;\n  }\n\n  Limit(value) {\n    this.limit = value;\n\n    return this;\n  }\n\n  Offset(value) {\n    this.offset = value;\n\n    return this;\n  }\n\n  Sort(value) {\n    this.sort = value;\n\n    return this;\n  }\n}\n\nexport default BaseExtend;\n","import BaseExtend from './base';\n\nclass CatalogueExtend extends BaseExtend {\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n\n  With(includes) {\n    if (includes) this.includes = includes.toString().toLowerCase();\n\n    return this;\n  }\n}\n\nexport default CatalogueExtend;\n","import { pluralize } from 'inflected';\nimport CatalogueExtend from '../extends/catalogue';\nimport { buildRelationshipData } from '../utils/helpers';\n\nclass ProductsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'products';\n  }\n\n  Filter(filter) {\n    this.filter = filter;\n\n    return this;\n  }\n\n  CreateRelationships(id, type, resources) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'POST', body);\n  }\n\n  DeleteRelationships(id, type, resources) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'DELETE', body);\n  }\n\n  UpdateRelationships(id, type, resources = null) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'PUT', body);\n  }\n}\n\nexport default ProductsEndpoint;\n","import BaseExtend from '../extends/base';\nimport StorageFactory from '../factories/storage';\n\nclass CurrenciesEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'currencies';\n    this.storage = new StorageFactory();\n  }\n\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n\n  Set(currency) {\n    const { config, storage } = this;\n\n    storage.set('mcurrency', currency);\n    config.currency = currency;\n\n    const promise = new Promise((resolve, reject) => {\n      const request = storage.get('mcurrency');\n\n      try {\n        resolve(request);\n      } catch (err) {\n        reject(new Error(err));\n      }\n    });\n\n    return promise;\n  }\n\n  Active() {\n    const storage = this.storage;\n\n    const promise = new Promise((resolve, reject) => {\n      const request = storage.get('mcurrency');\n\n      try {\n        resolve(request);\n      } catch (err) {\n        reject(new Error(err));\n      }\n    });\n\n    return promise;\n  }\n}\n\nexport default CurrenciesEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass BrandsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'brands';\n  }\n}\n\nexport default BrandsEndpoint;\n","import BaseExtend from '../extends/base';\n\nimport { cartIdentifier, buildCartItemData } from '../utils/helpers';\n\nclass CartEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'carts';\n    this.cartId = cartIdentifier();\n  }\n\n  Get(cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}`, 'GET');\n  }\n\n  Items(cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}/items`, 'GET');\n  }\n\n  AddProduct(productId, quantity = 1, cartId = this.cartId) {\n    const body = buildCartItemData(productId, quantity);\n\n    return this.request.send(`${this.endpoint}/${cartId}/items`, 'POST', body);\n  }\n\n  AddCustomItem(body, cartId = this.cartId) {\n    const itemObject = Object.assign(body, {\n      type: 'custom_item',\n    });\n\n    return this.request.send(`${this.endpoint}/${cartId}/items`, 'POST', itemObject);\n  }\n\n  AddPromotion(code, cartId = this.cartId) {\n    const body = buildCartItemData(code, null, 'promotion_item');\n\n    return this.request.send(`${this.endpoint}/${cartId}/items`, 'POST', body);\n  }\n\n  RemoveItem(itemId, cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}/items/${itemId}`, 'DELETE');\n  }\n\n  UpdateItemQuantity(itemId, quantity, cartId = this.cartId) {\n    const body = buildCartItemData(itemId, quantity);\n\n    return this.request.send(`${this.endpoint}/${cartId}/items/${itemId}`, 'PUT', body);\n  }\n\n  Checkout(body, cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}/checkout`, 'POST', body);\n  }\n\n  Delete(cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}`, 'DELETE');\n  }\n}\n\nexport default CartEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass CategoriesEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'categories';\n  }\n\n  Tree() {\n    return this.request.send(`${this.endpoint}/tree`, 'GET');\n  }\n}\n\nexport default CategoriesEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass CollectionsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'collections';\n  }\n}\n\nexport default CollectionsEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass OrdersEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'orders';\n  }\n\n  Items(id) {\n    return this.request.send(`${this.endpoint}/${id}/items`, 'GET');\n  }\n\n  Payment(id, body) {\n    return this.request.send(`${this.endpoint}/${id}/payments`, 'POST', body);\n  }\n\n  Transactions(id) {\n    return this.request.send(`${this.endpoint}/${id}/transactions`, 'GET');\n  }\n}\n\nexport default OrdersEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass GatewaysEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'gateways';\n  }\n\n  Update(slug, body) {\n    return this.request.send(`${this.endpoint}/${slug}`, 'PUT', body);\n  }\n\n  Enabled(slug, enabled) {\n    return this.request.send(`${this.endpoint}/${slug}`, 'PUT', {\n      type: 'gateway',\n      enabled,\n    });\n  }\n}\n\nexport default GatewaysEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass CustomersEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'customers';\n  }\n\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Token(email, password) {\n    const body = {\n      type: 'token',\n      email,\n      password,\n    };\n\n    return this.request.send(`${this.endpoint}/tokens`, 'POST', body);\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n}\nexport default CustomersEndpoint;\n","import 'fetch-everywhere';\nimport 'es6-promise';\n\nimport Config from './config';\nimport RequestFactory from './factories/request';\nimport StorageFactory from './factories/storage';\nimport ProductsEndpoint from './endpoints/products';\nimport CurrenciesEndpoint from './endpoints/currencies';\nimport BrandsEndpoint from './endpoints/brands';\nimport CartEndpoint from './endpoints/cart';\nimport CategoriesEndpoint from './endpoints/categories';\nimport CollectionsEndpoint from './endpoints/collections';\nimport OrdersEndpoint from './endpoints/orders';\nimport GatewaysEndpoint from './endpoints/gateways';\nimport CustomersEndpoint from './endpoints/customers';\n\nexport default class Moltin {\n  constructor(config) {\n    this.config = config;\n    this.request = new RequestFactory(config);\n    this.storage = new StorageFactory();\n\n    this.Products = new ProductsEndpoint(config);\n    this.Currencies = new CurrenciesEndpoint(config);\n    this.Brands = new BrandsEndpoint(config);\n    this.Cart = new CartEndpoint(config);\n    this.Categories = new CategoriesEndpoint(config);\n    this.Collections = new CollectionsEndpoint(config);\n    this.Orders = new OrdersEndpoint(config);\n    this.Gateways = new GatewaysEndpoint(config);\n    this.Customers = new CustomersEndpoint(config);\n  }\n\n  // Expose `authenticate` function on the Moltin class\n  Authenticate() {\n    return this.request.authenticate();\n  }\n}\n\n// Export a function to instantiate the Moltin class\nconst gateway = config => new Moltin(new Config(config));\n\nexport { gateway };\n"],"names":["bytesToUuid","buf","offset","i","bth","byteToHex","v4","options","Array","rnds","random","rng","ii","buildRelationshipData","type","ids","let","data","length","id","isArray","map","cartIdentifier","const","storage","StorageFactory","cartId","uuidv4","get","set","parseJSON","response","status","Promise","resolve","ok","json","then","formatFilterString","filter","Object","keys","key","value","join","formatQueryString","buildQueryParams","ref","includes","sort","limit","query","include","k","buildURL","endpoint","params","buildRequestBody","body","parsedBody","JSON","stringify","buildCartItemData","quantity","payload","assign","parseInt","code","Config","application","client_id","client_secret","currency","host","this","protocol","version","auth","expires","uri","sdk","language","localStorage","LocalStorage","require","window","setItem","getItem","delete","removeItem","crypto","global","msCrypto","getRandomValues","rnds8","Uint8Array","r","Math","toString","substr","RequestFactory","config","authenticate","Error","grant_type","promise","reject","fetch","method","headers","Content-Type","encodeURIComponent","catch","error","access_token","send","token","undefined","req","Authorization","X-MOLTIN-SDK-LANGUAGE","X-MOLTIN-SDK-VERSION","toUpperCase","Date","now","BaseExtend","request","All","call","Get","Limit","Offset","Sort","CatalogueExtend","Create","Delete","Update","With","toLowerCase","ProductsEndpoint","super","Filter","CreateRelationships","resources","pluralize","DeleteRelationships","UpdateRelationships","CurrenciesEndpoint","Set","err","Active","BrandsEndpoint","CartEndpoint","Items","AddProduct","productId","AddCustomItem","itemObject","AddPromotion","RemoveItem","itemId","UpdateItemQuantity","Checkout","CategoriesEndpoint","Tree","CollectionsEndpoint","OrdersEndpoint","Payment","Transactions","GatewaysEndpoint","slug","Enabled","enabled","CustomersEndpoint","Token","email","password","Moltin","Products","Currencies","Brands","Cart","Categories","Collections","Orders","Gateways","Customers","Authenticate","gateway"],"mappings":"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"}